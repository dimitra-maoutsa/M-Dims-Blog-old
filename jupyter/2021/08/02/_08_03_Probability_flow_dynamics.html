<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Probability flow dynamics for constraining stochastic nonlinear systems | M Dims Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Probability flow dynamics for constraining stochastic nonlinear systems" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Detailed description of Deterministic Particle Flow control of (upcoming paper) on controling stochastic nonlinear systems by deterministacally perturbing their dynamics." />
<meta property="og:description" content="Detailed description of Deterministic Particle Flow control of (upcoming paper) on controling stochastic nonlinear systems by deterministacally perturbing their dynamics." />
<link rel="canonical" href="https://dimitra-maoutsa.github.io/M-Dims-Blog/jupyter/2021/08/02/_08_03_Probability_flow_dynamics.html" />
<meta property="og:url" content="https://dimitra-maoutsa.github.io/M-Dims-Blog/jupyter/2021/08/02/_08_03_Probability_flow_dynamics.html" />
<meta property="og:site_name" content="M Dims Blog" />
<meta property="og:image" content="https://dimitra-maoutsa.github.io/M-Dims-Blog/images/landscape_r.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-02T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2021-08-02T00:00:00-05:00","url":"https://dimitra-maoutsa.github.io/M-Dims-Blog/jupyter/2021/08/02/_08_03_Probability_flow_dynamics.html","@type":"BlogPosting","image":"https://dimitra-maoutsa.github.io/M-Dims-Blog/images/landscape_r.png","headline":"Probability flow dynamics for constraining stochastic nonlinear systems","dateModified":"2021-08-02T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dimitra-maoutsa.github.io/M-Dims-Blog/jupyter/2021/08/02/_08_03_Probability_flow_dynamics.html"},"description":"Detailed description of Deterministic Particle Flow control of (upcoming paper) on controling stochastic nonlinear systems by deterministacally perturbing their dynamics.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/M-Dims-Blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://dimitra-maoutsa.github.io/M-Dims-Blog/feed.xml" title="M Dims Blog" /><link rel="shortcut icon" type="image/x-icon" href="/M-Dims-Blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/M-Dims-Blog/">M Dims Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/M-Dims-Blog/about/">About Me</a><a class="page-link" href="/M-Dims-Blog/search/">Search</a><a class="page-link" href="/M-Dims-Blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Probability flow dynamics for constraining stochastic nonlinear systems</h1><p class="page-description">Detailed description of Deterministic Particle Flow control of (upcoming paper) on controling stochastic nonlinear systems by deterministacally perturbing their dynamics.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-08-02T00:00:00-05:00" itemprop="datePublished">
        Aug 2, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/M-Dims-Blog/categories/#jupyter">jupyter</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/dimitra-maoutsa/M-Dims-Blog/tree/master/_notebooks/2021_08_03_Probability_flow_dynamics.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/M-Dims-Blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/dimitra-maoutsa/M-Dims-Blog/master?filepath=_notebooks%2F2021_08_03_Probability_flow_dynamics.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/M-Dims-Blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/dimitra-maoutsa/M-Dims-Blog/blob/master/_notebooks/2021_08_03_Probability_flow_dynamics.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/M-Dims-Blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Dynamics-of-constrained-densities">Dynamics of constrained densities </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021_08_03_Probability_flow_dynamics.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dynamics-of-constrained-densities">
<a class="anchor" href="#Dynamics-of-constrained-densities" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Dynamics of constrained densities</strong><a class="anchor-link" href="#Dynamics-of-constrained-densities"> </a>
</h2>
<p>Biological and physical systems are often subjected to intrinsic or extrinsic noise sources that influence their dynamics. Characteristic examples include molecular reactions and chemical kinetics <a href="#cite-gillespie2003improved">CITE</a>, populations of animal species, biological neurons <a href="#cite-saarinen2008stochastic">CITE</a>, and evolution <a href="#cite-lande2003stochastic">CITE</a>,<a href="#cite-takahata1975effect">CITE</a>.
 Stochastic differential equations (SDEs) effectively capture the phenomenology of the dynamics of such systems, at different precision scales 
 by both considering deterministic and stochastic forces affecting their state variables $X_t \in  \mathcal{R}^d$ following
  $$dX_t = f(X_t,t) dt  + \sigma dW_t.$$</p>
<p>In Eq.$(1)$ the drift  $f(\cdot,\cdot): \mathcal{R}^d \times \mathcal{R} \rightarrow \mathcal{R}^d$ is a smooth typically nonlinear function that captures the deterministic part of the driving forces,
while $W$ stands for a k--dimensional ($k\leq d$) vector of independent Wiener processes acting as
white noise sources, representing contributions from unaccounted degrees of freedom, thermal fluctuations, or external perturbations. We denote the noise strength by $\sigma \in \mathcal{R}$<sup class="footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup>, and define the noise covariance as
${D =\sigma ^2}$. In the following we refer to this system as the \emph{uncontrolled} system.</p>
<p>Under multiple independent realisations, the stochastic nature of Eq.$(1)$ gives rise to an ensemble of trajectories starting from an initial state $X_0=x_0$. This ensemble captures the likely evolution of the considered system at later time points. We may characterise the unfolding of this trajectory ensemble in terms of a probability density $p_t(x)$, whose evolution is governed by the Fokker--Planck equation</p>
\begin{align} \tag{2}
\frac{\partial p_t(x)}{\partial t} 
&amp;= \nabla\cdot \left[- f(x,t) p_t (x) + \frac{\sigma^2}{2} \nabla p_t(x)\right]\\
&amp;= {\cal{L}}_f^\dagger p_t(x) , \tag{3}
\end{align}<p>with initial condition $p_0(x) = \delta(x-x_0)$, and $\mathcal{L}_f^\dagger$ denoting the Fokker--Planck operator. Due to the stochastic nature of the system of Eq.$(1)$, exact pinpointing of its state at some later time point $T$ is in general not possible.</p>
<p>Yet, often, we desire to drive biophysical and biochemical stochastic processes to predefined target states within a specified time interval.
Characteristic examples include designing artificial selection strategies for population dynamics <a href="#cite-nourmohammad2021optimal">cite</a>, or triggering phenotype switches during cell fate determination <a href="#cite-wells2015control">cite</a>. Similar needs for manipulation are also relevant for non-biological, but rather technical systems, e.g. for control of robotic or artificial limbs <a href="#cite-todorov2005stochastic">cite</a>, <a href="#cite-todorov2004optimality">cite</a>. In all these settings, external system interventions become essential.</p>
<p>Here, we are interested in introducing constraints $\mathcal{C}$ to the dynamics of the system of Eq.($1$) acting within a predefined time interval ${0 \leq t \leq T}$. The set of possible constraints $\mathcal{C}$ comprises terminal $\chi(X_T)$, and/or path constraints $U(x,t),\text{for } t\leq T $, depending on whether the desired limiting conditions apply for the entire interval or only to the terminal time point.
The path constraints $U(x,t): \mathcal{R}^{d}\times \mathcal{R} \rightarrow \mathcal{R} $ penalise specific trajectories (<em>paths</em>) to render specific regions of the state space more (un)likely to be visited, while the function $\chi(x): \mathcal{R}^{d} \rightarrow \mathcal{R}$ influences the terminal system state $X_T$.</p>
<p>To incorporate the constraints $\mathcal{C}$ into the system, we define a modified dynamics, the <em>controlled</em> dynamics, 
through a change of probability measure of the path ensemble $\mathbb{P}_f$ induced by the uncontrolled system.
More precisely, we consider the path measure
$\mathbb{Q}$ 
 (Appendix A), induced by the controlled system, as equivalent to a <em>reweighting</em> of paths
$X_{0:T}$ generated from the uncontrolled dynamics (Eq.$(1)$) over the time interval $[0,\; T]$. 
Individual path weights are thus given by the likelihood ratio (<em>Radon--Nikodym derivative</em>)
\begin{equation}
\frac{d\mathbb{Q}}{d\mathbb{P}_f} (X_{0:T}) = \frac{\chi(X_T)}{Z} \exp\left[- \int_0^T U(X_t,t) dt \right], \tag{4}
\end{equation}
where $Z$ denotes the normalising constant 
\begin{equation}
Z = \Bigg \langle \chi(X_T) \exp\left(- \int_0^T U(X_t,t) dt \right) \Bigg\rangle_{\mathbb{P}_f},
\end{equation}
and $\langle \cdot \rangle_{\mathbb{P}_f}$ denotes the expectation over paths of the uncontrolled system.</p>
<p>According to the Girsanov's theorem, the controlled process defined by the weights of Eq.$(4)$ is also a diffusion process with the same diffusion constant $\sigma$, but with a modified, time-dependent drift function $g(x,t): \mathcal{R}^d \times \mathcal{R} \rightarrow \mathcal{R}^d$ <a href="#cite-girsanov1960transforming">cite</a>, <a href="#cite-oksendal2003stochastic">cite</a>.
Thus, we express the controlled dynamics as a time- and state- dependent perturbation $u(x,t): \mathcal{R}^d \times \mathcal{R} \rightarrow \mathcal{R}^d$ of the deterministic forces $f(x,t)$ acting on the system 
 \begin{align} 
     dX_t &amp;= \Big( f(X_t,t)   + u(X_t,t) \Big) \; dt + \sigma dW_t \tag{5} \\ &amp;= \hspace{25pt}g(X_t,t)\;\hspace{5pt} dt \hspace{30pt}+ \sigma dW_t.
 \end{align}</p>
<p>Our goal is to identify the <em>optimal</em> time- and state-dependent interventions $u(x,t)$ that minimise <em>intervention costs</em> and <em>path constraints</em> captured by the cost function
\begin{equation}
    S(x,u,t) =  \frac{1}{2} u(x,t)^T H u(x,t)+ U(x,t),
\end{equation}
while also drive the system towards a predefined target state $x^*$ by time $T$, if a terminal constraint is pertinent.
The first part of the cost function penalises large intervention values $u(x,t)$, with $H \in \mathcal{R}^{d \times d}$ determining the cost of intervention along each system dimension, whereas the path cost $U(x,t)$ constrains the transient behaviour of the system.</p>
<p>Solutions of this type of <em>stochastic control problems</em> rest on the Bellman's principle of optimality, according to which an optimal solution over an interval $[0,\;T]$ consists of optimal sub-solutions over the respective sub-intervals $[t',\;T]$ with later starting times $t'$,  and appropriate initial conditions <a href="bellman1956dynamic">cite</a>. This sequence of sub-problems with interdependent initial conditions requires the cost function $S(x,u,t)$ to be minimized over the entire time interval $[0,\;T]$. Therefore, here, we minimize the <em>total expected cost</em> in that interval defined as the sum of the terminal cost $\chi(X_T)$ and the time integrated path and intervention costs
\begin{equation}
 J(x,t=0) = \min_{u} \Big\langle  \int_{t=0}^T S(x,u,t') \,  dt' -  \ln \chi(X_T) \Big\rangle_{\mathbb{Q}}. \tag{6}
\end{equation}
In Eq.$(6)$, the brackets $\langle \cdot \rangle_{\mathbb{Q}}$ denote the expectation over the entire path probability measure $\mathbb{Q}$.</p>
<p>To establish the optimality of the interventions, we demand the cost functional $J(x,t)$ to follow the Hamilton--Jacobi--Bellman (<em>HJB</em>) equation (Appendix), 
\begin{align} \tag{7}
    -\frac{\partial}{\partial t} J(X_t,t) &amp;= \min_u \Bigg[ \frac{1}{2} u^T(X_t) H u(X_t) + U(X_t,t)\\ &amp;+ g(X_t,t) \nabla_x J(X_t,t) + \frac{1}{2} \text{Tr}[D \frac{\partial^2}{\partial x^2} J(X_t,t)]  \Bigg], \nonumber
\end{align}
a second-order <em>nonlinear</em> partial differential equation (<em>PDE</em>) with a terminal condition $J(x,T)= \ln \chi(X_T)$, which is, therefore, solved backwards in time. 
The gradient of the solution of this equation
\begin{equation}
    u^*(x,t) = - H^{-1}  \nabla J(x,t),
\end{equation}
provides the optimal state- and time-dependent interventions for the considered system with constraints $\mathcal{C}$. Yet,  without investigating the structure of the solution, direct solving a second-order nonlinear PDE requires computationally demanding calculations, that grow exponentially with increasing system dimension.</p>
<p>To simplify matters, we linearise the Hamilton--Jacobi--Bellman equation by employing a logarithmic variable transformation, $J(x,t) = - \log( \phi(x,t))$, proposed initially by Nelson in <a href="#cite-nelson2020dynamical">cite</a>, and introduced in the context of stochastic control by Fleming in <a href="fleming1977exit">cite</a> (<em>Hopf-Cole transform</em>). This requires the minimal assumption of the control costs $H$ and noise covariance $D$ being inversely proportional along each state dimension, $H \propto D^{-1}=\sigma^{-2}$, known in the literature as the <em>path integral control condition</em> <a href="#cite-kappen2005linear">cite</a>.</p>
<p>The logarithmic variable transformation allows us to express the resulting controlled drift 
\begin{equation} 
g(x,t)  = f(x,t) +  \sigma^2 \nabla \ln \phi(x,t), 
\tag{8}
\end{equation}
in terms of the solution $\phi_t(x) \doteq\phi(x,t) $ of a <em>linear</em> backward partial differential equation 
\begin{equation}
\frac{\partial \phi_t(x)}{\partial t} + {\cal{L}}_f \phi_t(x) - U(x,t) \phi_t(x) = 0 ,
\tag{9}
\end{equation}
with terminal condition $\phi_T(x) = \chi(X_T) $, and with $\mathcal{L}_f$ denoting the
adjoint Fokker--Planck operator (Appendix).</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1"><p>For the sake of brevity, we consider here a state independent diffusion, but the formalism easily generalises for a state dependent diffusion $\sigma(x)$, as outlined in the Appendix.}<a href="#fnref-1" class="footnote">â†©</a></p></li>
</ol>
</div>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="dimitra-maoutsa/M-Dims-Blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/M-Dims-Blog/jupyter/2021/08/02/_08_03_Probability_flow_dynamics.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/M-Dims-Blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/M-Dims-Blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/M-Dims-Blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A blog of M dimensions (under construction).</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/dimitra-maoutsa" title="dimitra-maoutsa"><svg class="svg-icon grey"><use xlink:href="/M-Dims-Blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/_dim_ma_" title="_dim_ma_"><svg class="svg-icon grey"><use xlink:href="/M-Dims-Blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
